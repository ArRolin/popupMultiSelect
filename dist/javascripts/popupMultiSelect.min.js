/*!
 * popupMultiSelect v0.1.0 (https://github.com/harshniketseta/popupMultiSelect)
 * Copyright 2011-2015, Author: Harshniket Seta <harshniketseta@gmail.com>
 * Licensed under MIT (https://github.com/harshniketseta/popupMultiSelect/blob/master/LICENSE)
 */
!function(a){a.fn.popupMultiSelect=function(b){"undefined"==typeof popupMultiSelectInitiated&&(popupMultiSelectInitiated=1);var c={},d=a.extend({},c,b);return this.each(function(){function c(a){return a.find(".optionsContent")}function e(b){var c=b.attr("id"),d=c.split("_")[1],e=a("#optionsModal_"+d);return e}function f(b){var c=b.attr("id"),d=c.split("_")[1],e=a("#optionsContainer_"+d);return e}function g(a,b){return a.find(".popupOption[data-index='"+b+"']")}function h(b,d){return c(b).find(".addedOption").filter(function(){return a(this).data("index")==d})}function i(b,c){var d=a("<span></span>",{"class":"text",text:b}),e=a("<span></span>",{"class":"glyphicon glyphicon-remove","aria-hidden":"true"}),f=a("<span></span>",{"class":"clickable removeOption"}).append(e),g=a("<span></span>",{"class":"addedOption",data:{index:c}}).append(d).append(f);return g}function j(a,b,c){var d=a.find("select");d.find("option:nth-child("+b+")").attr("selected",c)}function k(b){b.stopPropagation();var c=a(this),d=c.closest(".addedOption"),e=c.closest(".optionsContainer");l(d),m(e)}function l(a){var b=a.data("index"),c=a.closest(".optionsContainer"),d=e(c);return a.remove(),g(d,b).toggleClass("selected"),j(c,b,!1),o(c),!0}function m(a){var b="",c=a.find(".optionsContent").children().length,d=a.data("maxSelectionAllowed")||-1,f=d-c;1>d||(0===c&&f>0?b="Select "+f:f>0?b="Select "+f+" more.":0===f&&(b="Done."),e(a).find(".help-block.autoUpdate").html(b))}function n(a,b){{var d=b.data("maxSelectionAllowed")||-1,f=c(b),g=f.children().length;e(b)}if(d>0&&g==d)return!1;var h=a.data("index"),l=a.find(".displayText"),m=l.html(),n=i(m,h);return f.append(n),n.find(".removeOption").on("click",k),j(b,h,!0),!0}function o(a){var b=a.outerHeight(),c=a.outerWidth(),d=parseInt(a.css("padding-top")),e=parseInt(a.css("padding-bottom")),f=parseInt(a.css("padding-right")),g=parseInt(a.css("padding-left")),h=a.find(".optionsContent"),i=a.find(".openOptions"),j=i.find("i"),k=18,l=(b-k)/2,m=l-d,n=l-e,o=c-f-g-k;h.css({display:"block",width:o}),j.css({"font-size":k}),i.css({height:k,"padding-top":m,"padding-bottom":n,right:f})}function p(a){return a.find("option")}function q(b){var c=[];return a.each(b,function(b,d){var e=a("<span></span>",{"class":"displayText",text:d.text}),f=a("<span></span>",{"class":"glyphicon glyphicon-ok","aria-hidden":"true"}),g=a("<span></span>",{"class":"tick"}).append(f),h=a("<div></div>",{"class":"popupOption clickable",data:{index:b}}).append(e).append(g);d.selected&&h.addClass("selected"),c.push(h)}),c}function r(b,c){var d=c.helpText||"",e=(c.maxSelectionAllowed||-1,a("<div></div>",{"class":"modal-body"}).append(b)),f=a("<span></span>",{"class":"pull-right clickable close","aria-hidden":"true",text:"x"}),g=a("<h4></h4>",{"class":"modal-title",text:c.title||"Select Options"}),h=a("<div></div>",{"class":"help-block",text:d});0===d.length&&h.addClass("autoUpdate");var i=a("<div></div>",{"class":"modal-header"}).append(f).append(g).append(h),j=a("<div></div>",{"class":"modal-content"}).append(i).append(e),k=a("<div></div>",{"class":"modal-dialog modal-sm"}).append(j),l=a("<div></div>",{id:"optionsModal_"+c.identifier,"class":"popupMultiSelect modal fade"}).append(k);return l}function s(b){var c=a("<span></span>",{"class":"optionsContent"}),d=a("<span></span>",{"class":"glyphicon glyphicon-list","aria-hidden":"true"}),e=a("<span></span>",{"class":"openOptions clickable"}).append(d),f=a("<div></div>",{id:"optionsContainer_"+b.identifier,"class":"optionsContainer clearfix",data:{maxSelectionAllowed:b.maxSelectionAllowed}}).append(c).append(e);return f}function t(b,c){var d=!0;return a.each(c.find(".popupOption.selected"),function(){d=d&&n(a(this),b,c)}),m(b),d}function u(b,d){b.on("click",function(){var b=a(this),c=e(b);c.modal("show")}),d.find(".close").on("click",function(){var b=a(this),c=b.closest(".modal");c.modal("hide")}),d.find(".popupOption").on("click",function(){var b=a(this),c=b.closest(".modal"),d=f(c),e=b.data("index"),g=!0;g=b.hasClass("selected")?l(h(d,e)):n(b,d),g&&(b.toggleClass("selected"),m(d),o(d))}),c(b).find(".removeOption").on("click",k)}var v=a(this);if(!v.is("select"))return console.log("Popup MultiSelect only possible in select."),!0;b.identifier=popupMultiSelectInitiated;var w=p(v),x=q(w),y=r(x,d),z=s(d);a("body").append(y),v.replaceWith(z),v.css({display:"none"}),z.append(v),o(z),t(z,y),u(z,y),popupMultiSelectInitiated+=1})}}(jQuery);