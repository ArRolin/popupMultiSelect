/*!
 * popupMultiSelect v0.1.0 (https://github.com/harshniketseta/popupMultiSelect)
 * Copyright 2011-2015, Author: Harshniket Seta <harshniketseta@gmail.com>
 * Licensed under MIT (https://github.com/harshniketseta/popupMultiSelect/blob/master/LICENSE)
 */
!function(a){a.fn.popupMultiSelect=function(b){function c(a){return a.closest(".optionsContainer")}if("string"==typeof b)return"disable"===b?c(this).addClass("disabled"):"enable"===b&&c(this).removeClass("disabled"),this;var d={},e=a.extend({},d,b);return"undefined"==typeof popupMultiSelectInitiated&&(popupMultiSelectInitiated=1),this.each(function(){function b(a){return a.find(".optionsContent")}function c(b){var c=b.attr("id"),d=c.split("_")[1],e=a("#optionsModal_"+d);return e}function d(b){var c=b.attr("id"),d=c.split("_")[1],e=a("#optionsContainer_"+d);return e}function f(b,c){return b.find(".popupOption").filter(function(){return a(this).data("index")==c})}function g(c,d){return b(c).find(".addedOption").filter(function(){return a(this).data("index")==d})}function h(b,c){var d=a("<span></span>",{"class":"text",text:b}),e=a("<span></span>",{"class":"glyphicon glyphicon-remove","aria-hidden":"true"}),f=a("<span></span>",{"class":"clickable removeOption"}).append(e),g=a("<span></span>",{"class":"addedOption",data:{index:c}}).append(d).append(f);return g}function i(a,b,c){var d=a.find("select");d.find("option:nth-child("+b+")").attr("selected",c)}function j(b){b.stopPropagation();var d=a(this),e=d.closest(".addedOption"),g=e.data("index"),h=d.closest(".optionsContainer"),i=c(h),j=f(i,g),m=k(e);m&&(j.toggleClass("selected"),l(h),n(h))}function k(a){var b=a.data("index"),c=a.closest(".optionsContainer");return a.remove(),i(c,b,!1),n(c),!0}function l(a){var b="",d=a.find(".optionsContent").children().length,e=a.data("maxSelectionAllowed")||-1,f=e-d;1>e||(0===d&&f>0?b="Select "+f:f>0?b="Select "+f+" more.":0===f&&(b="Done."),c(a).find(".help-block.autoUpdate").html(b))}function m(a,d){{var e=d.data("maxSelectionAllowed")||-1,f=b(d),g=f.children().length;c(d)}if(e>0&&g==e)return!1;var k=a.data("index"),l=a.find(".displayText"),m=l.text(),n=h(m,k);return f.append(n),n.on("click",u),n.find(".removeOption").on("click",j),i(d,k,!0),!0}function n(a){var b=a.outerHeight(),c=a.outerWidth(),d=parseInt(a.css("padding-top")),e=parseInt(a.css("padding-bottom")),f=parseInt(a.css("padding-right")),g=parseInt(a.css("padding-left")),h=a.find(".optionsContent"),i=a.find(".openOptions"),j=i.find("i"),k=18,l=(b-k)/2,m=l-d,n=l-e,o=c-f-g-k;h.css({display:"block",width:o}),j.css({"font-size":k}),i.css({height:k,"padding-top":m,"padding-bottom":n,right:f})}function o(a){return a.find("option")}function p(b){var c=[];return a.each(b,function(b,d){var e=a("<span></span>",{"class":"displayText",text:d.text}),f=a("<span></span>",{"class":"glyphicon glyphicon-ok","aria-hidden":"true"}),g=a("<span></span>",{"class":"tick"}).append(f),h=a("<div></div>",{"class":"popupOption clickable",data:{index:b}}).append(e).append(g);d.selected&&h.addClass("selected"),c.push(h)}),c}function q(b,c){var d=c.helpText||"",e=(c.maxSelectionAllowed||-1,a("<div></div>",{"class":"modal-body"}).append(b)),f=a("<span></span>",{"class":"pull-right clickable close","aria-hidden":"true",text:"x"}),g=a("<h4></h4>",{"class":"modal-title",text:c.title||"Select Options"}),h=a("<div></div>",{"class":"help-block",text:d});0===d.length&&h.addClass("autoUpdate");var i=a("<div></div>",{"class":"modal-header"}).append(f).append(g).append(h),j=a("<div></div>",{"class":"modal-content"}).append(i).append(e),k=a("<div></div>",{"class":"modal-dialog modal-sm"}).append(j),l=a("<div></div>",{id:"optionsModal_"+c.identifier,"class":"popupMultiSelect modal fade"}).append(k);return l}function r(b,c){var d=a("<span></span>",{"class":"optionsContent"}),e=a("<span></span>",{"class":"glyphicon glyphicon-list","aria-hidden":"true"}),f=a("<span></span>",{"class":"openOptions clickable"}).append(e),g=a("<div></div>",{id:"optionsContainer_"+b.identifier,"class":"optionsContainer clearfix",data:{maxSelectionAllowed:b.maxSelectionAllowed}}).append(d).append(f);return c&&g.addClass("disabled"),g}function s(b,c){var d=!0;return a.each(c.find(".popupOption.selected"),function(){d=d&&m(a(this),b,c)}),l(b),d}function t(a){var b=c(a);b.modal("show")}function u(){var b=a(this),c=(b.data("index"),b.closest(".optionsContainer"));return c.hasClass("disabled")?!1:void t(c)}function v(b,c){b.find(".openOptions").on("click",function(){var b=a(this),c=b.closest(".optionsContainer");t(c)}),b.find(".addedOption").on("click",u),c.find(".close").on("click",function(){var b=a(this),c=b.closest(".modal");c.modal("hide")}),c.find(".popupOption").on("click",function(){var b=a(this),c=b.closest(".modal"),e=d(c),f=b.data("index"),h=!0;h=b.hasClass("selected")?k(g(e,f)):m(b,e),h&&(b.toggleClass("selected"),l(e),n(e))})}var w=a(this),x=w.prop("disabled");if(!w.is("select"))return console.log("Popup MultiSelect only possible in select."),!0;e.identifier=popupMultiSelectInitiated;var y=o(w),z=p(y),A=q(z,e),B=r(e,x);a("body").append(A),w.replaceWith(B),w.css({visibility:"hidden",height:"0px",width:"0px"}),B.append(w),n(B),s(B,A,x),v(B,A),popupMultiSelectInitiated+=1})}}(jQuery);