/*!
 * multiselect v0.1.0 (https://github.com/harshniketseta/popupMultiSelect)
 * Copyright 2011-2015, Author: Harshniket Seta <harshniketseta@gmail.com>
 * Licensed under MIT (https://github.com/harshniketseta/popupMultiSelect/blob/master/LICENSE)
 */
!function(a){"use strict";function b(b){return this.each(function(){var d=a(this),e=d.data("bs.multiselect"),f="object"==typeof b&&b;(e||!/destroy|hide/.test(b))&&(e||d.data("bs.multiselect",e=new c(this,f)),"string"==typeof b&&e[b]())})}var c=function(a,b){this.options=null,this.enabled=null,this.timeout=null,this.$element=null,this.type="multiselect",this.init(a,b)};if(!a.fn.modal)throw new Error("MultiSelect requires modal.js");c.VERSION="0.2.0",c.DEFAULTS={animation:!0,modalOptionTemplate:'<div class="option clickable"><span class="option-text"></span><span class="option-tick"><span class="glyphicon glyphicon-ok" aria-hidden="true"></span></span></div>',selectTemplate:'<div class="selectWrap  clearfix"><span class="select-content"></span><span class="open-options clickable"><span class="glyphicon glyphicon-list" aria-hidden="true"></span></span></div>',modalTemplate:'<div class="select modal in" aria-hidden="false"><div class="modal-dialog modal-sm"><div class="modal-content"><div class="modal-header"><span class="pull-right clickable close" aria-hidden="true">x</span><h4 class="modal-title"></h4><div class="help-block"></div></div><div class="modal-body"></div></div></div></div>',selectOptionTemplate:'<span class="addedOption" ><span class="text"></span><span class="clickable removeOption"><span class="glyphicon glyphicon-remove" aria-hidden="true"></span></span></span>',title:"Select Options"},c.prototype.init=function(b,c){var d=a(b);if(this.$element=d.clone(!0,!0),this.enabled=this.isEnabled(),this.options=this.getOptions(c),!this.$element.is("select"))throw new Error("Popup MultiSelect only possible in select.");this.$selectOptions=this.extractOptions(),this.replaceDefaultSelect(d)},c.prototype.getDefaults=function(){return c.DEFAULTS},c.prototype.getOptions=function(b){return b=a.extend({},this.getDefaults(),this.$element.data(),b)},c.prototype.isEnabled=function(){return!this.$element.prop("disabled")},c.prototype.extractOptions=function(){var b=[],d={modalOptionTemplate:this.options.modalOptionTemplate,selectOptionTemplate:this.options.selectOptionTemplate};return a.each(this.$element.find("option"),function(a,e){b.push(new c.Option(e,d))}),b},c.prototype.getMultiSelect=function(){return this.$multiSelect||(this.$multiSelect=a(this.options.selectTemplate),this.enabled||this.$multiSelect.addClass("disabled")),this.$multiSelect},c.prototype.getSelectOpenIcon=function(){var a=this.getMultiSelectOpen(),b=a.find("span.glyphicon");return b},c.prototype.getMultiSelectOpen=function(){return this.$openOptions||(this.$openOptions=this.$multiSelect.find(".open-options"))},c.prototype.getMultiSelectContent=function(){return this.$selectContent||(this.$selectContent=this.$multiSelect.find(".select-content"))},c.prototype.getSelected=function(){return this.getMultiSelectContent().children()},c.prototype.replaceDefaultSelect=function(a){var b=this.getMultiSelect();a.replaceWith(b),this.$element.css({visibility:"hidden",height:"0px",width:"0px"}),b.append(this.$element),this.postProcess(),this.initMultiSelect()},c.prototype.postProcess=function(){var a=this.$multiSelect.height(),b=this.$multiSelect.outerWidth(),c=parseInt(this.$multiSelect.css("padding-right")),d=parseInt(this.$multiSelect.css("padding-left")),e=this.getMultiSelectContent(),f=this.getMultiSelectOpen(),g=this.getSelectOpenIcon(),h=parseInt(g.css("font-size")),i=(a-h)/2,j=b-c-d-h;e.css({width:j}),f.css({height:h,"padding-top":i,"padding-bottom":i,right:c})},c.prototype.initMultiSelect=function(){var a=this;this.getMultiSelectOpen().on("click",function(){a.show()})},c.prototype.show=function(){var b=this.getModal();a("body").prepend(b),b.modal("show")},c.prototype.hide=function(){var a=this.getModal();a.modal("hide")},c.prototype.getModal=function(){return this.$modal||(this.$modal=a(this.options.modalTemplate),this.options.animation&&this.$modal.addClass("fade"),this.getModalHelpBlock(this.$modal).html(this.getModalHelpTextContent()),this.getModalBody(this.$modal).html(this.getModalBodyContent()),this.initModal(this.$modal)),this.$modal},c.prototype.getModalClose=function(a){return a.find(".close")},c.prototype.initModal=function(a){var b=this;this.getModalClose(a).on("click",function(){b.hide()})},c.prototype.getModalHelpBlock=function(a){return a=a||this.getModal(),a.find(".help-block")},c.prototype.getModalBody=function(a){return a=a||this.getModal(),a.find(".modal-body")},c.prototype.getModalHelpTextContent=function(){var a="",b=this.getSelected().length,c=this.options.maxSelectionAllowed,d=c-b;if(!(1>c))return 0===b&&d>0?a="Select "+d:d>0?a="Select "+d+" more.":0===d&&(a="Done."),a},c.prototype.getModalBodyContent=function(){var b=this,c=[];return a.each(this.$selectOptions,function(d,e){var f=e.createModalOption();f.on("click",function(){var c=a(this),d=c.data("multiselect.option");c.hasClass("selected")?b.optionUnSelected(d):b.optionSelected(d),b.postProcess()}),c.push(f)}),c},c.prototype.optionSelected=function(a){var b=this,c=a.getContent();a.selected(),c.find(".removeOption").on("click",function(){b.optionUnSelected(a)}),this.getMultiSelectContent().append(c)},c.prototype.optionUnSelected=function(a){a.unselected(),a.getContent().remove()},c.Option=function(a,b){this.options=null,this.enabled=null,this.timeout=null,this.$element=null,this.type="multiselect.option",this.init(a,b)},c.Option.DEFAULTS={},c.Option.prototype.init=function(b,c){if(this.$element=a(b),this.enabled=this.isEnabled(),this.options=this.getOptions(c),!this.$element.is("option"))throw new Error("Popup MultiSelect Option only possible on option element.")},c.Option.prototype.getDefaults=function(){return c.Option.DEFAULTS},c.Option.prototype.getOptions=function(b){return b=a.extend({},this.getDefaults(),this.$element.data(),b)},c.Option.prototype.isEnabled=function(){return!this.$element.prop("disabled")},c.Option.prototype.createModalOption=function(){return this.$tip||(this.$tip=a(this.options.modalOptionTemplate),this.$tip.find(".option-text").html(this.$element.html()),this.enabled||this.$tip.addClass("disabled"),this.$tip.data(this.type,this)),this.$tip},c.Option.prototype.selected=function(){this.$tip.addClass("selected")},c.Option.prototype.unselected=function(){this.$tip.removeClass("selected")},c.Option.prototype.getContent=function(){return this.$content||(this.$content=a(this.options.selectOptionTemplate),this.$content.find(".text").html(this.$element.html()),this.enabled||this.$content.addClass("disabled"),this.$content.data(this.type,this)),this.$content};var d=a.fn.multiselect;a.fn.multiselect=b,a.fn.multiselect.Constructor=c,a.fn.multiselect.noConflict=function(){return a.fn.multiselect=d,this}}(jQuery);